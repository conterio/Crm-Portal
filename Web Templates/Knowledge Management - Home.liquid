{% extends 'layout_1_column' %}

{% block main %}
  {% include 'page_copy' %}
  <div class="knowledge">
    <div class="knowledge-search">
      <div class="input-group">
        <input type="text" title="{{ snippets['HomeTemplate/Search'] | default: resx['HomeTemplate_Search_Text'] | h }}" placeholder="{{ snippets['KnowledgeMgmt/SearchKnowledgeBase'] | default: resx['KnowledgeMgmt_Search_Knowledge_Base'] | h }}" value="{{ request.params.kbquery }}" class="form-control input-lg" name="kbquery">
        <div class="input-group-btn">
          <button title="{{ snippets['KnowledgeMgmt/SearchKnowledgeBase'] | default: resx['KnowledgeMgmt_Search_Knowledge_Base'] | h }}" class="btn btn-default btn-lg" type="button">
            <i class="fa fa-search"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="knowledge-search-results">
      {% include 'Knowledge Management - Search Results' %}
    </div>
    <div class="row">
      <div class="col-sm-6">
        {% include 'Knowledge Management - Most Popular Articles' count: 5 %}
      </div>
      <div class="col-sm-6">
        {% include 'Knowledge Management - Most Recent Articles' count: 5 %}
      </div>
    </div>
  </div>
  {% raw %}
  <style>
    .knowledge .knowledge-search {
      margin-bottom: 20px;
    }
    .knowledge .knowledge-search-results {
      margin-bottom: 40px;
    }
  </style>
  <script type="text/javascript">
    $(function () {
      function submitSearch($this) {
        var inputs = $this.parents('.knowledge-search').find('input[name]');
        var params = $.map(inputs, function (e) {
          var $e = $(e);
          return encodeURIComponent($e.attr('name')) + '=' + encodeURIComponent($e.val());
        });
        window.location.search = params.join('&amp;');
      }
      
      $('.knowledge-search input').keypress(function (e) {
        if (e.which == 13) {
          e.preventDefault();
          submitSearch($(this));
        }
      });
      
      $('.knowledge-search button').click(function (e) {
        submitSearch($(this));
      });
    });
  </script>
  {% endraw %}
{% endblock %}